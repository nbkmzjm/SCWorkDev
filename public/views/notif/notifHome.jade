extends ../layout/layout.jade

	
block title 
	title Users

block header
	#header
	include ../layout/header.jade

block horMenu
	include ../layout/horMenu.jade

block content
	#container
		#userContainer
			ul(class="nav nav-tabs")
				li(class="active" id='feedTab')
					a(data-toggle="tab" href="#Feed") Feeds
				li(id='RelationshipTab')
					a(data-toggle="tab"  href="#Relationships") Relationships
				li(id='ProfileTab')
					a(data-toggle="tab"  href="#Profile") Profile
				li(	id='SettingTab')
					a(data-toggle="tab"  href="#Setting") Setting

			div(class="tab-content")
				div(id="Feed" class="tab-pane fade in active")
					

				div(id="Profile" class="tab-pane")
				div(id="Relationships" class="tab-pane")
				div(id="Setting" class="tab-pane")
append scripts 
	script(src="public/fnLib/feedFn.js")
	script.

		$(function(){
			feedHome()
			//- var groups = [{name:'a'}, {name:'b'}, {name:'c'}]
			//- ul = document.createElement('ul')
			//- groups.forEach(function(group, i){
			//- 	li = document.createElement('li')
			//- 	li.appendChild(document.createTextNode(group.name))
			//- 	console.log(li)
			//- 	li.addEventListener('click', function(){
			//- 		console.log(li)
			//- 	})
			//- 	ul.appendChild(li)
			//- 	console.log(group.name)
			//- })
			$('#feedTab').on('click', feedHome)

			function feedHome(){
				var div = document.createElement('div')
				div.className = 'input-group'
				div.classList.add('col-sm-8')
					


					//- span.classList.add('col-sm-3')
					
						var select = document.createElement('select')
						select.className = 'form-control col-sm-1'

						//- select.className = ''
						select.name = 'postTo'
						select.id = 'postTo'
							var optionList = ['mine','friend', 'friend of friend', 'public']
								//- var optionDB = document.createElement('option')
								//- optionDB.value = setting.value
								//- optionDB.innerHTML = setting.value
								//- select.appendChild(optionDB)

							optionList.forEach(function(item, i){
								//- if(item !== setting.value){
									var option = document.createElement('option')
									option.value = item
									option.innerHTML = item
									select.appendChild(option)
								//- }

							})

						
						div.appendChild(select)

						var span = document.createElement('span')
						span.className = 'input-group-btn'
						div.appendChild(span)
					

					


					var input = document.createElement('input')
					input.id = 'post'
					input.className = 'form-control'
					input.placeholder = 'Post announcement here'
					div.appendChild(input)


					var span = document.createElement('span')
					span.className = 'input-group-btn'
						var btn = document.createElement('button')
						btn.className = 'btn btn-primary'
						btn.innerHTML = 'POST'
						btn.addEventListener('click', function(){
							console.log(userSelected)
							input.value!==''?postDB(select.value, input.value):''
							//- input.value = ''
							feedHome()
						}) 
						span.appendChild(btn)
					div.appendChild(span)



					var divbtn = document.createElement('div')
					divbtn. className = 'input-group-btn'
						var btn = document.createElement('button')
						btn.className = 'btn btn-primary dropdown-toggle'
						btn.setAttribute('data-toggle', 'dropdown')
						btn.innerHTML = 'include'
							var span = document.createElement('span')
							span.className = 'caret'
							btn.appendChild(span)
						btn.appendChild(divbtn)

						var ul = document.createElement('ul')
						ul.className = 'dropdown-menu'
							var li = document.createElement('li')
								var a = document.createElement('a')
								a.href = 'www.yahoo.com'
								a.innerHTML = 'YAHOO'
								li.appendChild(a)
							ul.appendChild(li)
						divbtn.appendChild(ul)
					div.appendChild(divbtn)


					var userSelected = []
					var input = document.createElement('input')
					input.type = 'text'
					
					input.placeholder = 'Search Person'
					input.className ='form-control'
					input.id = 'friendSearch'
					input.setAttribute('href','#');
					input.setAttribute('data-toggle','popover');
					input.setAttribute('data-trigger','hover');
					input.setAttribute('data-placement','auto');
					input.style.fontWeight = 'bold'
					input.setAttribute('title', 'Selected User');
					
					document.addEventListener('mousemove', function(){
						input.setAttribute('data-content', JSON.stringify(userSelected, null, 4).replace(/"/g,"").replace("[","").replace("]",""));
						$('[data-toggle="popover"]').popover({html:true})
						
					})

					div.appendChild(input)

					BHUserList("friendSearch")
					
					
					
				$('#Feed').html(div)
				

				
				$('#friendSearch').bind('typeahead:selected', function(obj, group, name){
					$('#friendSearch').typeahead('val', '')
					userSelected.push(group.name.substring(0,group.name.indexOf("_")))
					console.log(obj)
					console.log(group)
					console.log(name)
				
				})
				getPostDB()


				//- $.getJSON('/notif/mainFeed').done(function(Rdata){
				//- 	Rdata.posts.forEach(function(post, i){
				//- 		console.log(post.postText)
				//- 	})
					
				//- })
			}


			$('#ProfileTab').on('click', function(){
				$('#Profile').html('')
				$.post('/notif/getUserPost').done(function(Rdata){
					console.log(Rdata)
					Rdata.user.mainPosts.forEach(function(post, i){
					var div = document.createElement('div')
					
					div.className = 'panel panel-primary'
					div.classList.add('col-sm-4')
						var divBody = document.createElement('div')
						divBody.className = 'panel-body'
							var h3 = document.createElement('h3')
							h3.innerHTML = post.postText
							divBody.appendChild(h3)
						div.appendChild(divBody)

						var divTitle = document.createElement('div')
						divTitle.className = 'panel-heading'
						div.appendChild(divTitle)

							var pUser = document.createElement('p')
							pUser.innerHTML =  Rdata.user.name + " posted " + moment(post.createdAt).fromNow()
							divTitle.appendChild(pUser)
						$('#Profile').append(div)
					})
					
				})
			})


			$('#RelationshipTab').on('click',function(){
				console.log('Relationships')
				ul = document.createElement('ul')
				ul.className = 'list-group'
				ul.classList.add('col-sm-4')
				var addGroup
				$.getJSON('/notif/userGetGroups').done(function(Rdata){
					var groupList = Rdata.groupList
					groupList.forEach(function(group,i){
						addGroup = function (groupName){
							li = document.createElement('li')
							li.className = 'list-group-item'
							li.appendChild(document.createTextNode(groupName))
								var span = document.createElement('span')
								span.style.float = 'right'
								if (group.userGroups.status=='ACTIVE'){
									span.style.color = '#2DC729'
									span.style.fontSize = '20px'
									span.className = "glyphicon glyphicon-link"
								}else if (group.userGroups.status=='PENDING'){
									span.style.color = '#F0C20B'
									span.style.fontSize = '20px'
									span.className = "glyphicon glyphicon-hourglass"
								}else if (group.userGroups.status=='OWNER'){
									span.style.color = '#DC14EE'
									span.style.fontSize = '20px'
									span.className = "glyphicon glyphicon-user"
								}else if (group.userGroups.status=='REQUEST'){
									span.style.color = '#EE1414'
									span.style.fontSize = '20px'
									span.className = "glyphicon glyphicon-question-sign"
									span.id = 'questionSign'
								}

								
								function myTest(){
									console.log('sfsf')
										$.post('/notif/editGroup',{
										groupSelectedId:group.id,
										action:'delete'
										}).done(function(pData){

											ul.removeChild(span.parentNode)

										})

								}
								span.addEventListener('mousedown', function(e){
									console.log(e)
									var mouseDown = true
									if(span.className=='glyphicon glyphicon-user'){
										
									

									}else if(span.className=='glyphicon glyphicon-question-sign'){
										$("#questionSign").hide()
										console.log(span.parentNode)

										var spanOk = document.createElement('span')
										spanOk.style.float = 'right'
										spanOk.style.color = 'green'
										spanOk.style.fontSize = '20px'
										spanOk.id = 'spanOk'
										spanOk.className = "glyphicon glyphicon-ok"
										spanOk.addEventListener('click',function(){
											$.post('/notif/editGroup',{
											groupSelectedId:group.id,
											action:'accept'
											}).done(function(pData){
												ul.removeChild(span.parentNode)
											})
										})
										
										span.parentNode.appendChild(spanOk)

										var spanSpace = document.createElement('span')
										spanSpace.style.float = 'right'
										spanSpace.innerHTML = '&nbsp&nbsp&nbsp&nbsp&nbsp'
										span.parentNode.appendChild(spanSpace)

										var spanDeny = document.createElement('span')
										spanDeny.style.float = 'right'
										spanDeny.style.color = 'red'
										spanDeny.style.fontSize = '20px'
										spanDeny.id = 'spanOk'

										spanDeny.className = "glyphicon glyphicon-remove"
										spanDeny.addEventListener('click',function(){
											$.post('/notif/editGroup',{
											groupSelectedId:group.id,
											action:'delete'
											}).done(function(pData){
												ul.removeChild(span.parentNode)
											})
										})
										span.parentNode.appendChild(spanDeny)
											
									}else if (mouseDown==true){

										

										var spanSpace = document.createElement('span')
										spanSpace.style.float = 'right'
										spanSpace.innerHTML = '&nbsp&nbsp&nbsp&nbsp&nbsp'
										span.parentNode.appendChild(spanSpace)

										var spanDeny = document.createElement('span')
										spanDeny.style.float = 'right'
										spanDeny.style.color = 'red'
										spanDeny.style.fontSize = '20px'
										spanDeny.id = 'spanOk'

										spanDeny.className = "glyphicon glyphicon-remove"
										spanDeny.addEventListener('click',function(){
											$.post('/notif/editGroup',{
											groupSelectedId:group.id,
											action:'delete'
											}).done(function(pData){
												ul.removeChild(span.parentNode)
											})
										})
										span.parentNode.appendChild(spanDeny)
										//- var spanDel = document.createElement('span')
										//- spanDel.style.float = 'right'
										//- spanDel.style.color = 'red'
										//- spanDel.id = 'spanDel'
										//- spanDel.className = "glyphicon glyphicon-remove"
										//- spanDel.innerHTML = "Release on icon to remove"
										//- ul.appendChild(spanDel)
										

									}
								
								})
								
								li.appendChild(span)
								
								
						}

						addGroup(group.name)
						ul.appendChild(li)

					})
					
					var liAddGroup = document.createElement('li')
					liAddGroup.className = 'list-group-item'
						//- var inputgroup = document.createElement('div')
						//- inputgroup.className = 'input-group'
						
						//- liAddGroup.appendChild(inputgroup)

							//- var span = document.createElement('span')
							//- span.className = 'input-group-btn'
							//- //- span.id = 'basic-addon1'
							//- 	var btn = document.createElement('button')
							//- 	btn.className = 'btn btn-primary'
							//- 	//- btn.type = 'button'
							//- 	span.appendChild(btn)
							//- inputgroup.appendChild(span)

							var input = document.createElement('input')
							input.type = 'text'
							
							input.placeholder = 'Search and Select to ADD'
							input.className ='form-control'
							input.id = 'groupSearch'
							//- input.setAttribute("aria-describedby", "basic-addon1")
							liAddGroup.appendChild(input)
					ul.appendChild(liAddGroup)

					$('#Relationships').append(ul)

					BHUserList("groupSearch")

					$('#groupSearch').bind('typeahead:selected', function(obj, group, name){

						$.post('/notif/editGroup',{
						groupSelectedId:group.id,
						action:'add'
						}).done(function(pData){
							console.log("xx: "+JSON.stringify(group, null, 4))
							addGroup(pData.group.name)
							ul.appendChild(li)
							$('#groupSearch').val('')
							
					
						});
					})
				})
				$('#Relationships').html(ul)
			
			})

			$('#SettingTab').on('click', function(){
				$('#Setting').html('')
				var settingList = ['I want to view post from', 'who can see my post']
				$.post('/notif/getFeedSetting').done(function(Rdata){

					Rdata.settings.forEach(function(setting){


					
						var div = document.createElement('div')
						div.className = 'form-group col-sm-8'

							var label = document.createElement('label')
							label.className = 'col-sm-5'
							label.innerHTML = setting.settingDescription.description
							div.appendChild(label)

							var divSelect = document.createElement('div')
							divSelect.className = 'col-sm-3'


								var select = document.createElement('select')
								select.className = 'form-control'
								select.name = 'viewPostFrom'
								select.id = 'viewPostFrom'
									var optionList = ['mine','friend', 'friend of friend', 'public']
										var optionDB = document.createElement('option')
										optionDB.value = setting.value
										optionDB.innerHTML = setting.value
										select.appendChild(optionDB)

									optionList.forEach(function(item, i){
										if(item !== setting.value){
											var option = document.createElement('option')
											option.value = item
											option.innerHTML = item
											select.appendChild(option)
										}

									})
								select.addEventListener('change', function(){

									//- alert(select.value)
									$.post('/notif/setFeedSetting',{
										settingId:setting.id,
										settingValue:select.value,
										action:'update'
									}).done(function(Rdata){

									})
								})
								
								divSelect.appendChild(select)

							div.appendChild(divSelect)
						$('#Setting').append(div)

					})
				})


				
					
				
			})
			
				
		})