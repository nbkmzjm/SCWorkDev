extends ../layout/layout.jade

	
block title 
	title Users

block header
	#header
	include ../layout/header.jade

block horMenu
	include ../layout/horMenu.jade

block content
	#container
		#userContainer
			ul(class="nav nav-tabs")
				li(class="active" id='userListTab')
					a(data-toggle="tab" href="#Feeds") Feeds
				li(id='userFormTab')
					a(data-toggle="tab"  href="#Relationships") Relationships

			div(class="tab-content")
				div(id="Feeds" class="tab-pane fade in active")
					p this is feeding pages

				div(id="Relationships" class="tab-pane")
					
					


		

	

append scripts 
	script.

		$(function(){

			ul = document.createElement('ul')
			ul.className = 'list-group'
			ul.classList.add('col-sm-3')

			$.getJSON('/notif/userGetGroups').done(function(Rdata){
				var groupList = Rdata.groupList
				groupList.forEach(function(group,i){
					li = document.createElement('li')
					li.className = 'list-group-item'
					li.innerHTML = group.name
						var span = document.createElement('span')
						span.style.float = 'right'
						if (group.userGroups.status=='ACTIVE'){
							span.style.color = '#2DC729'
							span.className = "glyphicon glyphicon-ok"
						}else if (group.userGroups.status=='PENDING'){
							span.style.color = '#DC14EE'
							span.className = "glyphicon glyphicon-hourglass"
						}
						
						
						li.appendChild(span)
					li.addEventListener('click', function(){
						var spanDel = document.createElement('span')
						spanDel.style.float = 'right'
						spanDel.style.color = 'red'
						spanDel.className = "glyphicon glyphicon-remove"
						li.insertBefore(spanDel, li.childNodes[0])
						
					})
					ul.appendChild(li)
				})
				
				var liAddGroup = document.createElement('li')
				liAddGroup.className = 'list-group-item'
					//- var inputgroup = document.createElement('div')
					//- inputgroup.className = 'input-group'
					
					//- liAddGroup.appendChild(inputgroup)

						//- var span = document.createElement('span')
						//- span.className = 'input-group-btn'
						//- //- span.id = 'basic-addon1'
						//- 	var btn = document.createElement('button')
						//- 	btn.className = 'btn btn-primary'
						//- 	//- btn.type = 'button'
						//- 	span.appendChild(btn)
						//- inputgroup.appendChild(span)

						var input = document.createElement('input')
						input.type = 'text'
						
						input.placeholder = 'Search and Select to ADD'
						input.className ='form-control'
						input.id = 'groupSearch'
						//- input.setAttribute("aria-describedby", "basic-addon1")
						liAddGroup.appendChild(input)
						

				ul.appendChild(liAddGroup)




				$('#Relationships').append(ul)

				$.post('/notif/groupList').done(function(pData){
					var result = pData.groupList.map(function(group) {
						return group;
						});
					console.log(result)
					// constructs the suggestion engine
					var groupList = new Bloodhound({
						identify: function(obj) { return obj.name; },
					  	datumTokenizer: Bloodhound.tokenizers.obj.whitespace('name'),
					  	queryTokenizer: Bloodhound.tokenizers.whitespace,
					  // `states` is an array of state names defined in "The Basics"
					  	local: result
									
					});
					console.log(groupList)

					function groupDefault(q, sync) {
						if (q === '') {
						    sync(groupList.get('BCP', 'ACH', 'APS'));
						 }else {
						    groupList.search(q, sync);
						 }


					}

					$('#groupSearch').typeahead({
						hint: true,
					  	highlight: true,
					  	minLength: 0
					},{
					  	name: 'states',
					  	display: 'name',
					  	source: groupDefault,
					  	templates: {
						  	empty: [
						      '<div class="empty-message">',
						        'unable to find any group with current search',
						      '</div>'
						    ].join('\n')
						    ,
						    suggestion: function (data) {
							        return '<p><strong>' + data.name + '</strong> - ' + data.active + '</p>';
							    }
					  }
					});
				})
				$('#groupSearch').bind('typeahead:selected', function(obj, group, name){
					console.log(group.id)
					$.post('/notif/editGroup',{
					groupSelectedId:group.id,
					action:'add'
					}).done(function(pData){
						console.log(JSON.stringify(pData, null, 4))
						var li = document.createElement('li')
						li.className = 'list-group-item'
						

						li.innerHTML = pData.group.name
						$('#groupSearch').val('')
						ul.appendChild(li)
				
					});
				})
				


				$('#Relationships').append(ul)
				
				
				
			})
				
		})